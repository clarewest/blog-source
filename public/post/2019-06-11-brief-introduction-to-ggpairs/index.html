<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> Brief introduction to ggpairs - Clare&#39;s Blog </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="Description for the page" />
    <meta property="og:site_name" content="Clare&#39;s Blog" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://clarewest.github.io/blog-hugo/post/2019-06-11-brief-introduction-to-ggpairs/" />
    <meta property="og:title" content="Brief introduction to ggpairs" />
    <meta property="og:image" content="https://clarewest.github.io/blog-hugoimages/image.png" />
    <meta property="og:description" content="Description for the page" />

    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="Brief introduction to ggpairs" />
    <meta name="twitter:description" content="Description for the page" />
    <meta name="twitter:image" content="https://clarewest.github.io/blog-hugoimages/image.png" />

    <link rel="canonical" href="https://clarewest.github.io/blog-hugo/post/2019-06-11-brief-introduction-to-ggpairs/">
    <link rel="stylesheet" href="https://clarewest.github.io/blog-hugo/font-awesome-4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin="anonymous" />

    <link rel="stylesheet" href="https://clarewest.github.io/blog-hugo/css/custom.css" />

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css" integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin="anonymous" />
    

    

    <link rel="shortcut icon"
        href="https://clarewest.github.io/blog-hugo/images/favicon.png">

    
    <link href="https://clarewest.github.io/blog-hugo/index.xml" rel="alternate" type="application/rss+xml" title="Clare&#39;s Blog" />
    
</head>

<body>
    
    <div class="mt-xl header">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-auto">
                <a href="https://clarewest.github.io/blog-hugo">
                    <h1 class="name">Clare&#39;s Blog</h1>
                </a>
            </div>
        </div>

        <div class="row justify-content-center">
            <ul class="nav nav-primary">
                
                <li class="nav-item">
                    <a class="nav-link" href="https://clarewest.github.io/blog-hugo/">
                        
                        Home
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://clarewest.github.io/blog-hugo/about/">
                        
                        About
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/clarewest">
                        
                        GitHub
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://twitter.com/claree_west">
                        
                        Twitter
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="https://clarewest.github.io">
                        
                        Website
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

    <div class="content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-lg-8">
                    <h1 class="mx-0 mx-md-4">Brief introduction to ggpairs</h1>
                    <div class="markdown">
                        
    <p>In this blog post I will introduce a fun R plot, ggpairs, that&rsquo;s useful for exploring distributions and correlations.</p>
<p>Recently, I was trying to recreate the kind of base graphics figures generated using plot() or pairs()</p>
<p>For example, let&rsquo;s say we have 500 models of two target proteins, and we want to compare how two scores (e.g. EigenTHREADER, SAINT2) compare to the quality of the models (TMScore):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">require(dplyr)
df = read.table(<span style="color:#a31515">&#34;https://raw.githubusercontent.com/clarewest/RFQAmodel/master/data/RFQAmodel_training.txt&#34;</span>, 
                header=<span style="color:#00f">TRUE</span>, 
                stringsAsFactors=<span style="color:#00f">FALSE</span>) %&gt;%
     filter(Target %in% c(<span style="color:#a31515">&#34;2OBA_B&#34;</span>,<span style="color:#a31515">&#34;3HSB_D&#34;</span>)) %&gt;% 
     select(Target, EigenTHREADER, SAINT2, TMScore)

plot(df[,2:4])

</code></pre></div><p><img src="images/base_pairs.png" alt=""></p>
<p>I&rsquo;m interested in recreating this plot using my visualisation package of choice, ggplot2, and I found the best way to do this is using ggpairs (&ldquo;Ggplot2 Generalized Pairs Plot&rdquo;), part of the ggplot2 extension package GGally.</p>
<ul>
<li><a href="https://ggobi.github.io/ggally/">GGally documentation</a></li>
<li><a href="https://www.rdocumentation.org/packages/GGally/versions/1.4.0/topics/ggpairs">ggpairs documentation</a></li>
</ul>
<p>This function creates a similar plot to the base example above, with the added benefit of displaying the correlation coefficient (Pearson, by default) in the upper triangle, distributions on the diagonal, and all the fun flexibility that you would expect from ggplot2:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">require(ggplot2)
require(GGally)
ggplot2::theme_set(ggplot2::theme_bw())  <span style="color:#008000">## (this just globally sets the ggplot2 theme to theme_bw) </span>
df %&gt;% select(-Target) %&gt;% ggpairs()

</code></pre></div><p><img src="images/ggpairs.png" alt=""></p>
<p>Plots in the upper and lower triangles and the diagonal are modified separately. The options and parameters are passed to each  as a list.</p>
<p>Each combination of variables are plotted according to whether they are:</p>
<ul>
<li>continuous: e.g. &ldquo;points&rdquo; (lower default), &ldquo;smooth&rdquo;, &ldquo;smooth_loess&rdquo;, &ldquo;density&rdquo;, &ldquo;cor&rdquo; (upper default), or &ldquo;blank&rdquo;</li>
<li>combo: e.g. &ldquo;box&rdquo;, &ldquo;box_no_facet&rdquo; (upper default), &ldquo;dot&rdquo;, &ldquo;dot_no_facet&rdquo;, &ldquo;facethist&rdquo;, &ldquo;facetdensity&rdquo;, &ldquo;denstrip&rdquo;, or &ldquo;blank&rdquo;</li>
<li>discrete: e.g. &ldquo;ratio&rdquo;, &ldquo;facetbar&rdquo;, or &ldquo;blank&rdquo;</li>
</ul>
<p>Plots on the diagonal can either be:</p>
<ul>
<li>continuous: &ldquo;densityDiag&rdquo;, &ldquo;barDiag&rdquo;, &ldquo;blankDiag&rdquo;</li>
<li>discrete: &ldquo;barDiag&rdquo;, &ldquo;blankDiag&rdquo;</li>
</ul>
<p>(If you are not familiar with the term facet, it refers to the <a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">splitting of a single plot into two or more panels (facets)</a>, and is one of the most useful features of ggplot2)</p>
<p>For example, to plot points with a smoothed line for pairs of continous variables in the lower triangle, and make the points smaller and more transparent:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">
df %&gt;% select(-Target) %&gt;% ggpairs(., lower = list(continuous = wrap(<span style="color:#a31515">&#34;smooth&#34;</span>, alpha = 0.3, size=0.1)))

</code></pre></div><p><img src="images/ggpairs_smooth.png" alt=""></p>
<p>It&rsquo;s also possible to provide your own plotting function.</p>
<p>We can now map aesthetics, for example colour the points according to the target protein, which will also show the (far more interesting) correlations within the target proteins separately:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">df %&gt;% ggpairs(., 
               mapping = ggplot2::aes(colour=Target), 
               lower = list(continuous = wrap(<span style="color:#a31515">&#34;smooth&#34;</span>, alpha = 0.3, size=0.1)))
</code></pre></div><p><img src="images/ggpairs_colour.png" alt=""></p>
<p>Notice how we now have facethist and box plots for &ldquo;combo&rdquo; (discrete and continuous) combinations of variables in the lower and upper triangles, respectively, and a bar plot showing the total number of models on the Target diagonal.</p>
<p>You can also display a legend.</p>
<p>By default all columns of the data are included in the plot, use the columns argument to exclude:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">df %&gt;% ggpairs(.,
               legend = 1,
               columns = 2:4, 
               mapping = ggplot2::aes(colour=Target), 
               lower = list(continuous = wrap(<span style="color:#a31515">&#34;smooth&#34;</span>, alpha = 0.3, size=0.1))) +
               theme(legend.position = <span style="color:#a31515">&#34;bottom&#34;</span>)  
</code></pre></div><p><img src="images/ggpairs_column.png" alt=""></p>
<p>Some extra things for my final plot:</p>
<ul>
<li>To change the alignment of the correlation labels to fit the group names in, use alignPercent</li>
<li>Change the alpha so we can see the distributions more clearly</li>
<li>Remove the histograms</li>
</ul>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">df %&gt;% ggpairs(.,
               title = <span style="color:#a31515">&#34;A Nice Plot Using ggpairs&#34;</span>, 
               mapping = ggplot2::aes(colour=Target), 
               lower = list(continuous = wrap(<span style="color:#a31515">&#34;smooth&#34;</span>, alpha = 0.3, size=0.1), 
                            discrete = <span style="color:#a31515">&#34;blank&#34;</span>, combo=<span style="color:#a31515">&#34;blank&#34;</span>), 
               diag = list(discrete=<span style="color:#a31515">&#34;barDiag&#34;</span>, 
                           continuous = wrap(<span style="color:#a31515">&#34;densityDiag&#34;</span>, alpha=0.5 )), 
               upper = list(combo = wrap(<span style="color:#a31515">&#34;box_no_facet&#34;</span>, alpha=0.5),
                            continuous = wrap(<span style="color:#a31515">&#34;cor&#34;</span>, size=4, alignPercent=0.8))) + 
               theme(panel.grid.major = element_blank())    <span style="color:#008000"># remove gridlines </span>
</code></pre></div><p><img src="images/ggpairs_modified.png" alt=""></p>
<p>Now my problem is that I&rsquo;m not interested in that first column. Getting around this is a bit convoluted, but here&rsquo;s my solution.</p>
<p>You can extract individual or combinations of panels:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">p &lt;- df %&gt;% ggpairs(.,
               title = <span style="color:#a31515">&#34;A Nice Plot Using ggpairs&#34;</span>, 
               mapping = ggplot2::aes(colour=Target), 
               lower = list(continuous = wrap(<span style="color:#a31515">&#34;smooth&#34;</span>, alpha = 0.3, size=0.1), 
                            discrete = <span style="color:#a31515">&#34;blank&#34;</span>, combo=<span style="color:#a31515">&#34;blank&#34;</span>), 
               diag = list(discrete=<span style="color:#a31515">&#34;barDiag&#34;</span>, 
                           continuous = wrap(<span style="color:#a31515">&#34;densityDiag&#34;</span>, alpha=0.5 )), 
               upper = list(combo = wrap(<span style="color:#a31515">&#34;box_no_facet&#34;</span>, alpha=0.5),
                            continuous = wrap(<span style="color:#a31515">&#34;cor&#34;</span>, size=4, alignPercent=0.8))) + 
               theme(panel.grid.major = element_blank())    <span style="color:#008000"># remove gridlines </span>

getPlot(p, 1, 4) + guides(fill=<span style="color:#00f">FALSE</span>)
</code></pre></div><p><img src="images/ggpairs_panel.png" alt=""></p>
<p>So if I extract the panels I&rsquo;m interested in, I can then display them using ggmatrix</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">plots = list()
for (i in 1:4){
  plots &lt;- c(plots, lapply(2:p$ncol, function(j) getPlot(p, i = i, j = j)))
}  
ggmatrix(plots, 
         nrow = 4, 
         ncol=p$ncol-1, 
         xAxisLabels = p$xAxisLabels[2:p$ncol], 
         yAxisLabels = p$yAxisLabels, 
         title=<span style="color:#a31515">&#34;Nice plot with only the panels I care about&#34;</span>)

</code></pre></div><p><img src="images/ggpairs_final.png" alt=""></p>
<p><del>Sidenote: If you know how to iterate over i and j at once in apply (and end up with a list) please share your secrets with me.</del></p>
<p>Update: My colleague <a href="https://twitter.com/lbozhilova">Lyuba</a> has offered a better solution to the above iteration method using expand.grid:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-R" data-lang="R">plots &lt;- apply(expand.grid(i=1:4, j=2:p$ncol), 1, function(ij) getPlot(p, i=ij[1], j=ij[2]))
ggmatrix(plots,
         byrow=<span style="color:#00f">FALSE</span>, 
         nrow = 4, 
         ncol=p$ncol-1, 
         xAxisLabels = p$xAxisLabels[2:p$ncol], 
         yAxisLabels = p$yAxisLabels, 
         title=<span style="color:#a31515">&#34;Nice plot with only the panels I care about&#34;</span>)

</code></pre></div><p>Note that with the expand.grid method, we need the option byrow=FALSE in the ggmatrix call, so that the matrix is filled up by column instead and the panels end up in the correct position. Thanks Lyuba!</p>
<p><em>This blog post was originally posted on the <a href="https://www.blopig.com/blog/2019/06/a-brief-introduction-to-ggpairs/">OPIG blog</a>.</em></p>


                    </div>
                </div>
            </div>
        </div>
    </div>

    <section id="comments">
    <div class="py-3 content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-sm-12 col-lg-8">
                    <div class="comments">
                        <script src="https://utteranc.es/client.js" repo=""
                            issue-term="pathname" label="comment" theme="github-light" crossorigin="anonymous" async>
                            </script>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
    <footer class="site-footer">
<div class="content">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-sm-12 col-lg-8">

                      <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Clare E. West</li></ul>
      </div>
      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          <li>
            <a href="https://github.com/clarewest">
                                  <i class="fa fa-github social-icon"></i>

                <span class="username">clarewest</span>
                </a>
                </li>
                <li>
                  <a href="http://twitter.com/claree_west">
                    <i class="fa fa-twitter social-icon"></i>
                    <span class="username">claree_west</span></a>
                    </li>
                    </ul>
      
</div>

      <div class="footer-col footer-col-3">
        <p>Data adventures of a former biochemist.</p>
      </div>
      </div>
                       
                        
                  </div>
        </div>
    </div>
</div>
</footer>


    

    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js" defer></script>
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/stan.min.js" defer></script>
        
        <script>
            window.addEventListener('load', function() {
                hljs.initHighlighting();
            }, true);
        </script>
    

    

    
    
        
<script src="https://clarewest.github.io/blog-hugo/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
</body>

</html>
